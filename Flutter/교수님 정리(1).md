# 4장. 플러터 필수 개념 이해하기 - 요약

## 📌 학습 목표
플러터를 효과적으로 활용하기 위해, 반드시 알아야 할 아키텍처 구조, 위젯 시스템의 원리, 라이프사이클의 흐름, 레이아웃 구성 방식, 애니메이션 처리 기법, 그리고 라우팅 및 내비게이션 전략에 대한 핵심 개념을 이해하고, 이를 실제 코딩을 통해 구현할 수 있는 능력을 기른다.

---

## 1. 플러터 아키텍처

### 📊 3계층 구조
```
┌─────────────────────────────┐
│   Framework (Dart)          │ ← 앱 개발자가 주로 사용
├─────────────────────────────┤
│   Engine (C/C++)            │ ← 렌더링과 코어 기능
├─────────────────────────────┤
│   Embedder (Platform)       │ ← 플랫폼별 구현
└─────────────────────────────┘
```

### 주요 구성 요소

#### 1) **임베더 (Embedder)**
- 각 플랫폼별 네이티브 코드 (Android: Java/C++, iOS: Objective-C)
- 화면 렌더링, 이벤트 처리, 접근성 기능 제공

#### 2) **엔진 (Engine)**
- C++로 작성된 핵심 렌더링 엔진
- Skia 그래픽 라이브러리 활용
- 파일/네트워크 I/O, 텍스트 레이아웃 처리

#### 3) **프레임워크 (Framework)**
- Dart로 작성된 반응형 UI 프레임워크
- Material/Cupertino 디자인 시스템
- 위젯 시스템과 상태 관리

---

## 2. 위젯 (Widget) 시스템

### 🎯 핵심 개념
> **"플러터에서 모든 것은 위젯이다"**
> - 버튼, 텍스트부터 패딩, 마진까지 모두 위젯
> - 레고 블록처럼 조합하여 UI 구성

### 3가지 기본 위젯

#### 1) **StatelessWidget**
```dart
// 불변 위젯 - 상태가 변하지 않음
class MyWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Text('Hello');
  }
}
```
**장점**: 성능 최적화, 스레드 안전성, 예측 가능성

#### 2) **StatefulWidget**
```dart
// 가변 위젯 - 상태 변경 가능
class MyWidget extends StatefulWidget {
  @override
  _MyWidgetState createState() => _MyWidgetState();
}

class _MyWidgetState extends State<MyWidget> {
  int counter = 0;
  
  void increment() {
    setState(() {
      counter++;
    });
  }
}
```
**용도**: 사용자 상호작용, 동적 UI, 애니메이션

#### 3) **InheritedWidget**
- 위젯 트리에서 데이터 공유
- Provider의 기반 기술
- 불필요한 리빌드 방지

---

## 3. 라이프사이클

### 📈 StatelessWidget 라이프사이클
```
Constructor → createElement → build
```
- 단순한 구조
- 상태 변경 시 전체 재생성

### 📊 StatefulWidget 라이프사이클
```
Constructor → createState → initState → didChangeDependencies 
    → build → setState → build (반복) → dispose
```

#### 주요 메서드 역할
| 메서드 | 호출 시점 | 용도 |
|--------|-----------|------|
| `initState()` | 위젯 생성 시 1회 | 초기화 작업 |
| `didChangeDependencies()` | initState 후 1회 | context 접근 필요한 초기화 |
| `build()` | UI 갱신 필요 시 | UI 구성 |
| `setState()` | 상태 변경 시 | 화면 갱신 트리거 |
| `didUpdateWidget()` | 부모 위젯 변경 시 | 이전/현재 값 비교 |
| `dispose()` | 위젯 제거 시 | 리소스 정리 |

---

## 4. 레이아웃 위젯

### 🏗️ 주요 레이아웃 위젯

#### 기본 구조 위젯
| 위젯 | 용도 | 주요 속성 |
|------|------|-----------|
| **Container** | 박스 모델 | padding, margin, decoration |
| **Row** | 가로 배치 | mainAxisAlignment, crossAxisAlignment |
| **Column** | 세로 배치 | mainAxisAlignment, crossAxisAlignment |
| **Stack** | 겹침 배치 | alignment, fit |
| **Positioned** | Stack 내 위치 지정 | left, top, right, bottom |

#### 공간 활용 위젯
- **Expanded**: Row/Column 내 남은 공간 채우기
- **SizedBox**: 고정 크기 박스 또는 간격 생성

#### 스크롤 가능 위젯
```dart
// ListView - 스크롤 가능한 목록
ListView(
  scrollDirection: Axis.vertical,
  children: [...],
)

// GridView - 그리드 레이아웃
GridView(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 3,
  ),
  children: [...],
)

// PageView - 페이지 단위 스크롤
PageView(
  children: [...],
)
```

---

## 5. 애니메이션

### ✨ 암시적 애니메이션 (간단한 애니메이션)

#### 주요 위젯
```dart
// 투명도 애니메이션
AnimatedOpacity(
  duration: Duration(seconds: 1),
  opacity: isVisible ? 1.0 : 0.0,
  child: Widget(),
)

// 위치 애니메이션
AnimatedPositioned(
  duration: Duration(milliseconds: 500),
  left: position,
  child: Widget(),
)

// 컨테이너 애니메이션
AnimatedContainer(
  duration: Duration(milliseconds: 300),
  width: size,
  height: size,
  color: color,
)
```

#### 공통 옵션
- `duration`: 애니메이션 지속 시간
- `curve`: 애니메이션 곡선 (linear, ease, bounce 등)
- `onEnd`: 애니메이션 종료 콜백

---

## 6. 라우팅 (네비게이션)

### 🗺️ 페이지 전환 방법

#### 라우트 정의
```dart
MaterialApp(
  initialRoute: '/',
  routes: {
    '/': (context) => HomePage(),
    '/second': (context) => SecondPage(),
    '/third': (context) => ThirdPage(),
  },
)
```

#### 네비게이션 메서드
| 메서드 | 동작 | 사용 예시 |
|--------|------|-----------|
| `pushNamed` | 새 페이지 스택에 추가 | 일반 페이지 이동 |
| `pop` | 현재 페이지 제거 | 뒤로 가기 |
| `pushReplacementNamed` | 현재 페이지 교체 | 로그인 후 홈 이동 |
| `popUntil` | 특정 경로까지 제거 | 회원가입 완료 후 |

```dart
// 페이지 이동
Navigator.pushNamed(context, '/second');

// 뒤로 가기
Navigator.pop(context);

// 페이지 교체
Navigator.pushReplacementNamed(context, '/home');

// 특정 경로까지 돌아가기
Navigator.popUntil(context, ModalRoute.withName('/'));
```

---

## 📚 핵심 요약

### ✅ 꼭 기억해야 할 내용

1. **위젯 선택 기준**
   - 상태 변경 없음 → StatelessWidget
   - 상태 변경 필요 → StatefulWidget
   - 데이터 공유 필요 → InheritedWidget/Provider

2. **라이프사이클 활용**
   - 초기화: `initState()`
   - Context 필요한 초기화: `didChangeDependencies()`
   - 상태 변경: `setState()`
   - 정리 작업: `dispose()`

3. **레이아웃 구성 팁**
   - Row/Column으로 기본 구조 잡기
   - Expanded로 유연한 공간 배분
   - Stack/Positioned로 겹침 효과
   - ListView/GridView로 스크롤 구현

4. **성능 최적화**
   - const 생성자 활용
   - 불필요한 setState 최소화
   - 적절한 위젯 타입 선택

### 🎯 실무 활용 팁

- **상태 관리**: 단순한 경우 setState, 복잡한 경우 Provider/Bloc
- **레이아웃**: 먼저 큰 구조를 잡고 세부사항 조정
- **애니메이션**: 암시적 애니메이션으로 시작, 필요시 명시적 애니메이션
- **라우팅**: routes 사전 정의로 체계적인 네비게이션 구성

---

## 🔗 참고 자료
- 예제 소스: https://github.com/sudar-life/stateful_lifecycle_sample
- 라우팅 예제: https://github.com/sudar-life/flutter_route_sample
